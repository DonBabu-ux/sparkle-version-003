<%- include('partials/head', { title: 'Dashboard' }) %>

    <style>
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                padding-bottom: 80px;
                padding-top: 70px;
                /* Space for navbar */
            }

            .afterglow-section {
                margin: 0 -15px 20px -15px;
                padding: 15px;
                background: white;
            }

            .stories-container {
                gap: 12px !important;
                padding-bottom: 5px;
            }

            .story-create-card,
            .story-card {
                min-width: 110px !important;
                height: 160px !important;
            }

            .story-create-avatar {
                width: 45px !important;
                height: 45px !important;
            }

            .afterglow-title {
                font-size: 18px !important;
            }

            .vanish-timer {
                font-size: 10px !important;
            }

            .posts-feed {
                padding: 0;
            }

            .post-card {
                margin-bottom: 15px;
                border-radius: 16px !important;
            }
        }
    </style>

    <style>
        body {
            opacity: 0;
            animation: pageFadeIn 0.4s ease-out forwards;
            background-color: #f0f2f5;
        }

        @keyframes pageFadeIn {
            from {
                opacity: 0;
                background-color: #ffe6f0;
            }

            to {
                opacity: 1;
                background-color: #f0f2f5;
            }
        }
    </style>

    <%- include('partials/sidebar') %>

        <!-- Main Content Container -->
        <div class="container" id="mainContent">
            <!-- Home Page (Default) -->
            <div id="homePage" class="page active">
                <%- include('partials/navbar') %>

                    <!-- AfterGlow Stories Section -->
                    <div class="afterglow-section">
                        <div class="afterglow-header">
                            <div class="afterglow-title">
                                <i class="fas fa-sun" style="color: #FFD700;"></i>
                                AfterGlow
                                <span class="vanish-timer" id="vanishTimer">
                                    <i class="fas fa-clock"></i>
                                    <span id="hoursTillVanish">24</span>hrs till vanish
                                </span>
                            </div>
                        </div>

                        <!-- Stories Container -->
                        <div class="stories-container" id="afterglowStories">
                            <!-- Create Story -->
                            <div class="story-create-card" onclick="window.showCreateOptions()">
                                <div class="story-nav-area left" onclick="nextStory()"></div>
                                <div class="story-nav-area right" onclick="prevStory()"></div>
                                <div class="story-create-inner">
                                    <div class="story-create-avatar-container">
                                        <img src="<%= user.avatar_url || '/uploads/avatars/default.png' %>"
                                            alt="Your Story" class="story-create-avatar"
                                            onerror="this.onerror=null;this.src='/uploads/avatars/default.png';">
                                        <div class="story-create-ring"></div>
                                        <div class="story-create-plus">
                                            <i class="fas fa-plus"></i>
                                        </div>
                                    </div>
                                    <div class="story-create-label">Create AfterGlow</div>
                                </div>
                            </div>
                            <!-- Real Stories load here -->
                        </div>
                    </div>

                    <!-- Posts Feed -->
                    <div class="posts-feed" id="feed" style="margin-top: 20px;">
                        <div style="text-align:center; padding: 40px; color: #999;">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p style="margin-top: 10px;">Sparking your feed...</p>
                        </div>
                    </div>
            </div> <!-- End of homePage -->
        </div> <!-- End of mainContent -->

        <!-- AfterGlow Viewer Modal -->
        <div id="afterglowViewer" class="afterglow-viewer-modal" style="display: none;">
            <div class="afterglow-viewer-container">
                <div class="afterglow-viewer-header">
                    <div class="afterglow-progress" id="viewerProgress">
                        <!-- Segments will be injected by script.js -->
                    </div>
                    <div class="viewer-author-info">
                        <img id="viewerAvatar" src="" alt="Avatar" class="viewer-avatar"
                            onerror="this.onerror=null;this.src='/uploads/avatars/default.png';">
                        <div class="viewer-author-details">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div id="viewerUsername" class="viewer-username"></div>
                                <span id="viewerCampus" class="viewer-campus-badge"></span>
                            </div>
                            <div id="viewerTime" class="viewer-time"></div>
                        </div>
                    </div>
                    <div class="viewer-controls">
                        <button class="viewer-btn viewer-close-btn" onclick="closeAfterglowViewer()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <div class="afterglow-viewer-content">
                    <!-- Navigation Areas (Tap to skip) -->
                    <div class="story-nav-touch-area left" onclick="prevStory()"></div>
                    <div class="story-nav-touch-area right" onclick="nextStory()"></div>

                    <div id="viewerMedia" class="viewer-media">
                        <!-- Media will be loaded here -->
                    </div>

                    <div class="afterglow-viewer-footer">
                        <div class="viewer-stats-row">
                            <span class="viewer-stat-item">
                                <i class="fas fa-eye"></i>
                                <span id="viewCount">0</span>
                            </span>
                            <span class="viewer-stat-item">
                                <i class="fas fa-bolt"></i>
                                <span id="sparkCount">0</span>
                            </span>
                        </div>
                        <div id="viewerCaption" class="afterglow-caption"></div>

                        <div class="viewer-actions">
                            <button class="viewer-action-btn spark-action" onclick="sparkAfterglow()">
                                <div class="action-icon-circle">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <span>Spark</span>
                            </button>
                            <button class="viewer-action-btn share-action" onclick="shareAfterglow()">
                                <div class="action-icon-circle">
                                    <i class="fas fa-share"></i>
                                </div>
                                <span>Share</span>
                            </button>
                            <button class="viewer-action-btn save-action" onclick="saveAfterglow()">
                                <div class="action-icon-circle">
                                    <i class="far fa-bookmark"></i>
                                </div>
                                <span>Save</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Desktop Navigation Arrows -->
                <button class="desktop-nav-btn prev" onclick="prevStory()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="desktop-nav-btn next" onclick="nextStory()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>


        <script>
            // Dynamic AfterGlow implementation


        </script>

        <!-- Modals and other dashboard-specific components -->
        <%- include('partials/dashboard-modals') %>
            <%- include('partials/share-modal') %>

                <%- include('partials/bottom-nav') %>

                    <script src="/js/dataManager.js"></script>
                    <script src="/js/apiClient.js"></script>
                    <script src="/js/dashboardAPI.js"></script>
                    <script src="/js/shareManager.js"></script>
                    <script src="/js/script.js"></script>
                    <script src="/js/dynamicPatch.js"></script>
                    </body>

                    </html>