<%- include('partials/head', { title: 'Group Feed' }) %>

    <body>
        <%- include('partials/sidebar') %>

            <div class="container" id="mainContent">
                <!-- Header -->
                <div class="header glass">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="hamburger-btn" onclick="window.location.href='/groups'" style="cursor:pointer;">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div style="font-weight: 700; font-size: 18px;">Your Group Feed</div>
                    </div>
                </div>

                <!-- Feed Content -->
                <div class="feed-container" style="padding-top: 20px;">
                    <% if (typeof posts !=='undefined' && posts.length> 0) { %>
                        <% posts.forEach(post=> { %>
                            <div class="post-card" data-post-id="<%= post.post_id %>"
                                onclick="window.location.href='/groups/<%= post.group_id %>'">
                                <div class="post-header">
                                    <div class="post-avatar-wrapper">
                                        <img src="<%= post.avatar_url || '/uploads/avatars/default.png' %>"
                                            alt="<%= post.user_name %>" class="post-avatar">
                                    </div>
                                    <div class="post-user-info">
                                        <div class="post-username">
                                            <%= post.user_name %>
                                                <span style="color: #64748b; font-weight: 400; font-size: 0.9em;"> in
                                                </span>
                                                <span style="color: var(--primary); font-weight: 600;">
                                                    <%= post.group_name %>
                                                </span>
                                        </div>
                                        <div class="post-time">
                                            <%= new Date(post.created_at).toLocaleString() %>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-caption">
                                    <%= post.content %>
                                </div>
                                <% if (post.media_url) { %>
                                    <img src="<%= post.media_url %>" class="post-media" alt="Post media">
                                    <% } %>
                                        <div class="post-actions" onclick="event.stopPropagation()">
                                            <button class="action-btn"><i class="far fa-heart"></i>
                                                <%= post.sparks || 0 %>
                                            </button>
                                            <button class="action-btn"><i class="far fa-comment"></i>
                                                <%= post.comments || 0 %>
                                            </button>
                                        </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <div class="discover-empty-state" style="margin-top: 50px;">
                                        <div class="empty-icon-wrapper">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                        <h4>No posts yet</h4>
                                        <p>Join more groups to see updates here!</p>
                                        <button onclick="window.location.href='/groups'" class="settings-save-btn"
                                            style="width: auto; padding: 10px 30px; margin-top: 15px;">Discover
                                            Groups</button>
                                    </div>
                                    <% } %>
                </div>
            </div>

            <%- include('partials/dashboard-modals') %>
                <script src="/js/dashboardAPI.js"></script>
                <script>
                    // Sidebar Compatibility
                    function showGroupManagement() { window.location.href = '/groups'; }
                    function createGroup() { window.location.href = '/groups'; }
                    function showGroupFeed() { window.location.href = '/groups/feed'; }
                    function hideHamburger() {
                        document.getElementById('hamburgerMenu')?.classList.remove('active');
                        document.getElementById('hamburgerOverlay')?.classList.remove('active');
                    }
                </script>
    </body>

    </html>