<%- include('partials/head', { title: 'Group Feed' }) %>
    <style>
        @media (max-width: 768px) {
            #mainContent {
                padding-top: 60px !important;
            }

            .feed-container {
                padding: 10px 0 !important;
            }

            .post-card {
                margin: 0 0 10px 0 !important;
                border-radius: 0 !important;
            }
        }
    </style>

    <body>
        <%- include('partials/sidebar') %>

            <div class="container" id="mainContent">
                <!-- Header -->
                <div class="header glass">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="hamburger-btn" onclick="window.location.href='/groups'" style="cursor:pointer;">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div style="font-weight: 700; font-size: 18px;">Your Group Feed</div>
                    </div>
                </div>

                <!-- Feed Content -->
                <div class="feed-container" style="padding-top: 20px;">
                    <% if (typeof posts !=='undefined' && posts.length> 0) { %>
                        <% posts.forEach(post=> { %>
                            <div class="post-card <%= !post.media_url ? 'text-only' : '' %>"
                                data-post-id="<%= post.post_id %>"
                                onclick="window.location.href='/groups/<%= post.group_id %>'">

                                <!-- 1. MEDIA SECTION (Media First) -->
                                <div class="post-content">
                                    <% if (post.media_url) { %>
                                        <div class="post-media-container">
                                            <img src="<%= post.media_url %>" class="post-image" alt="Post media">
                                        </div>
                                        <% } %>
                                </div>

                                <!-- 2. HEADER SECTION (60px) -->
                                <div class="post-header">
                                    <img src="<%= post.avatar_url || '/uploads/avatars/default.png' %>"
                                        alt="<%= post.user_name %>" class="post-avatar">
                                    <div class="post-author-info">
                                        <div class="post-username-row">
                                            <span class="post-username">@<%= post.user_name %></span>
                                            <span class="post-time-simple">• <%= new
                                                    Date(post.created_at).toLocaleDateString() %></span>
                                        </div>
                                        <div class="post-meta-row">
                                            <span style="color: var(--primary); font-weight: 600;">
                                                <%= post.group_name %>
                                            </span> • <%= post.campus || 'Main Campus' %>
                                        </div>
                                    </div>
                                    <button class="post-options-btn"><i class="fas fa-ellipsis-h"></i></button>
                                </div>

                                <!-- 3. TEXT CONTENT AREA -->
                                <div class="post-text-body">
                                    <div class="post-caption-full">
                                        <%= post.content %>
                                    </div>
                                </div>

                                <!-- 4. METRICS BAR -->
                                <div class="post-metrics-bar">
                                    <div class="metric-item"><i class="fas fa-bolt"></i> <span class="spark-count">
                                            <%= post.sparks || 0 %>
                                        </span></div>
                                    <div class="metric-item"><i class="far fa-comment"></i> <span class="comment-count">
                                            <%= post.comments || 0 %>
                                        </span></div>
                                    <div class="metric-item"><i class="far fa-eye"></i> <span class="view-count">
                                            <%= post.views || 0 %>
                                        </span></div>
                                    <div class="metric-item"><i class="fas fa-share"></i> <span class="share-count">
                                            <%= post.shares || 0 %>
                                        </span></div>
                                </div>

                                <!-- 5. ACTION BAR (Equal width buttons) -->
                                <div class="post-action-bar">
                                    <button class="action-btn-custom spark"
                                        onclick="event.stopPropagation(); window.toggleSpark('<%= post.post_id %>', this)">
                                        <i class="far fa-bolt"></i>
                                        <span>Spark</span>
                                    </button>
                                    <button class="action-btn-custom comment"
                                        onclick="event.stopPropagation(); window.location.href='/post/<%= post.post_id %>'">
                                        <i class="far fa-comment"></i>
                                        <span>Comment</span>
                                    </button>
                                    <button class="action-btn-custom share"
                                        onclick="event.stopPropagation(); window.shareManager.openShareSheet('post', '<%= post.post_id %>')">
                                        <i class="far fa-share-square"></i>
                                        <span>Share</span>
                                    </button>
                                    <button class="action-btn-custom save"
                                        onclick="event.stopPropagation(); window.toggleSavePost('<%= post.post_id %>', this)">
                                        <i class="far fa-bookmark"></i>
                                        <span>Save</span>
                                    </button>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <div class="discover-empty-state" style="margin-top: 50px;">
                                        <div class="empty-icon-wrapper">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                        <h4>No posts yet</h4>
                                        <p>Join more groups to see updates here!</p>
                                        <button onclick="window.location.href='/groups'" class="settings-save-btn"
                                            style="width: auto; padding: 10px 30px; margin-top: 15px;">Discover
                                            Groups</button>
                                    </div>
                                    <% } %>
                </div>
            </div>

            <%- include('partials/dashboard-modals') %>
                <script src="/js/dashboardAPI.js"></script>
                <script>
                    // Sidebar Compatibility
                    function showGroupManagement() { window.location.href = '/groups'; }
                    function createGroup() { window.location.href = '/groups'; }
                    function showGroupFeed() { window.location.href = '/groups/feed'; }
                    function hideHamburger() {
                        document.getElementById('hamburgerMenu')?.classList.remove('active');
                        document.getElementById('hamburgerOverlay')?.classList.remove('active');
                    }
                </script>
    </body>

    </html>